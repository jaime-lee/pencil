var Pencil=function(e,i){i=i||{},this._currentPixel=void 0,this._mousedown=!1,this._pixelSize=i.pixelSize||1,this._color=i.color||"black",this._canvasElem=e,this._pixels={};var t=this;e.addEventListener("mousedown",function(e){t._mousedownFn(e)}),window.addEventListener("mouseup",function(e){t._mouseupFn(e)}),window.addEventListener("mousemove",function(e){t._mousemoveFn(e)})};Pencil._bres=function(e,i){var t=[],n=e.x<i.x,o=n?e.x:i.x,r=n?e.y:i.y,s=n?i.x:e.x,l=n?i.y:e.y,c=l>r?1:-1;if(o===s){for(var _=r;_!==l+c;_+=c)t.push({x:o,y:_});return t}for(var h=0,p=Math.abs((l-r)/(s-o)),_=r,x=s>o?1:-1,a=o;a!==s+x;a+=x){t.push({x:a,y:_}),h+=p;for(var u=a,P=_;Math.abs(h)>.5&&_!==l;)(u!==a||P!==_)&&(t.push({x:a,y:_}),u=a,P=_),_+=c,h-=1}return t},Pencil.prototype.setColor=function(e){this._color=e},Pencil.prototype.setPixelSize=function(e){this._pixelSize=e,this._redraw()},Pencil.prototype._clearCanvas=function(){var e=this._canvasElem,i=e.getContext("2d");i.clearRect(0,0,e.width,e.height)},Pencil.prototype.clear=function(){this._clearCanvas(),this._pixels={}},Pencil._copyPixels=function(e){var i={};for(var t in e){t=parseInt(""+t),i[t]={};for(var n in e[t])n=parseInt(""+n),i[t][n]=e[t][n]}return i},Pencil.prototype.loadPixels=function(e){this._pixels=Pencil._copyPixels(e),this._redraw()},Pencil.prototype.getPixels=function(){return Pencil._copyPixels(this._pixels)},Pencil.prototype._redraw=function(){this._clearCanvas();for(var e in this._pixels)for(var i in this._pixels[e])this._renderPixel({x:e,y:i})},Pencil.prototype._getCoordFromEvent=function(e){var i=this._canvasElem.getBoundingClientRect();return{x:e.clientX-i.left,y:e.clientY-i.top}},Pencil.prototype._getPixelFromEvent=function(e){var i=this._getCoordFromEvent(e);return{x:Math.floor(i.x/this._pixelSize),y:Math.floor(i.y/this._pixelSize)}},Pencil.prototype._renderPixel=function(e){var i=this._pixels[e.x][e.y],t=this._canvasElem.getContext("2d");t.fillStyle=i,t.fillRect(this._pixelSize*e.x,this._pixelSize*e.y,this._pixelSize,this._pixelSize)},Pencil.prototype._drawPixel=function(e){e.x*this._pixelSize>=this._canvasElem.width||e.y*this._pixelSize>=this._canvasElem.height||(this._pixels[e.x]||(this._pixels[e.x]={}),this._pixels[e.x][e.y]=this._color,this._renderPixel(e))},Pencil.prototype._mousedownFn=function(e){this._mousedown=!0,this._currentPixel=this._getPixelFromEvent(e),this._drawPixel(this._currentPixel)},Pencil.prototype._mousemoveFn=function(e){if(this._mousedown===!0){e.preventDefault();for(var i=this._getPixelFromEvent(e),t=this._currentPixel,n=Pencil._bres(i,t),o=0;o<n.length;o++)this._drawPixel(n[o]);this._currentPixel=i}},Pencil.prototype._mouseupFn=function(){this._mousedown=!1};