var Pencil=function(e,i){i=i||{},this._currentPixel=void 0,this._mousedown=!1,this._pixelSize=i.pixelSize||1,this._canvasElem=e,this._color="black",this._pixels={};var t=this;e.addEventListener("mousedown",function(e){t._mousedownFn(e)}),window.addEventListener("mouseup",function(e){t._mouseupFn(e)}),window.addEventListener("mousemove",function(e){t._mousemoveFn(e)})};Pencil.bres=function(e,i){var t=[],n=e.x<i.x,o=n?e.x:i.x,s=n?e.y:i.y,r=n?i.x:e.x,l=n?i.y:e.y,h=l>s?1:-1;if(o===r){for(var c=s;c!==l+h;c+=h)t.push({x:o,y:c});return t}for(var x=0,_=Math.abs((l-s)/(r-o)),c=s,p=r>o?1:-1,u=o;u!==r+p;u+=p){t.push({x:u,y:c}),x+=_;for(var a=u,v=c;Math.abs(x)>.5&&c!==l;)(a!==u||v!==c)&&(t.push({x:u,y:c}),a=u,v=c),c+=h,x-=1}return t},Pencil.prototype.setColor=function(e){this._color=e},Pencil.prototype.setPixelSize=function(e){this._pixelSize=e,this._redraw()},Pencil.prototype.clear=function(){var e=this._canvasElem,i=e.getContext("2d");i.clearRect(0,0,e.width,e.height)},Pencil.prototype._redraw=function(){this.clear();for(var e in this._pixels)for(var i in this._pixels[e])this._renderPixel({x:e,y:i})},Pencil.prototype._getCoordFromEvent=function(e){var i=this._canvasElem.getBoundingClientRect();return{x:e.clientX-i.left,y:e.clientY-i.top}},Pencil.prototype._getPixelFromEvent=function(e){var i=this._getCoordFromEvent(e);return{x:Math.floor(i.x/this._pixelSize),y:Math.floor(i.y/this._pixelSize)}},Pencil.prototype._renderPixel=function(e){var i=this._pixels[e.x][e.y],t=this._canvasElem.getContext("2d");t.fillStyle=i,t.fillRect(this._pixelSize*e.x,this._pixelSize*e.y,this._pixelSize,this._pixelSize)},Pencil.prototype._drawPixel=function(e){e.x*this._pixelSize>=this._canvasElem.width||e.y*this._pixelSize>=this._canvasElem.height||(this._pixels[e.x]||(this._pixels[e.x]={}),this._pixels[e.x][e.y]=this._color,this._renderPixel(e))},Pencil.prototype._mousedownFn=function(e){this._mousedown=!0,this._currentPixel=this._getPixelFromEvent(e)},Pencil.prototype._mousemoveFn=function(e){if(this._mousedown===!0){for(var i=this._getPixelFromEvent(e),t=this._currentPixel,n=Pencil.bres(i,t),o=0;o<n.length;o++)this._drawPixel(n[o]);this._currentPixel=i}},Pencil.prototype._mouseupFn=function(){this._mousedown=!1};